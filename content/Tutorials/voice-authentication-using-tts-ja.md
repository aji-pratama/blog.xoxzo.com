Title: テキスト読み上げ機能を使って、電話で認証してみましょう!
Date: 2018-03-09 10:00
Author: Miko-chan
Tags: 通話; 音声; テキスト読み上げ; api; チュートリアル; ミコちゃん; 認証;
Slug: making-a-voice-authentication-call-with-tts
Thumbnail: images/xoxtan.png
Lang: ja
Summary: このチュートリアルでは、APIをひとつ呼び出すだけで、テキスト読み上げ機能を使って、どうやって認証コードを読むのか解説しまぁす！

<div>
  <img src="https://blog.xoxzo.com/images/xoxtan.png" class="float-lg-right lg-width200 md-width300" style="margin: 0;">
</div>

こんにちはぁ！実は、ミコちゃんのチュートリアル、お久しぶりなんデス。
使ってくれるみんなのために、APIを治したり、良くしたり・・・って、バタバタしてましたっ！
でも、また、戻ってきたからよろしくね！
さぁ、じゃぁ、新しいレッスンを始めちゃおう！

前回は、[音声案内を発信しましょう！]({filename}./making-a-simple-playback-call-ja.md) ということで、
指定した電話番号へ電話を発信して、準備しておいたmp3ファイルを再生するっていうのを、勉強しましたね？

今回は、あなたの伝えたい内容を、きちんと伝えられるように、テキスト読み上げ機能（TTSって言うわね）をつかって、電話をかける方法を
教えちゃうねっ！

TTSを使うだけで、発信した電話を受け取った相手に、伝えたいことを大きく変えることが、できちゃうんです。
といことは、よく電話がかかってきて、認証コードを読み上げて、声でお知らせしてくれるっていうようなことが、
SMSで送るかわりに、できちゃうってことなんです！

Googleとか、Facebookとかの、ネットの大きなサービス企業では、「通話してるデバイスを、本人がちゃんと保持してます」ってことを
認証する手段として、このやり方を使ってるよねっ？

<div style="clear:both;"></div>

## 必要なものは? ##

- まずは、通話のできる電話番号を、[E.164フォーマット](https://ja.wikipedia.org/wiki/E.164)で、準備してねっ！ 
このフォーマットは、つまり、先頭に + のついた、国番号 付きの電話番号ってことです！あと、有効な発信者番号もね。
- もちろん、APIユーザーも必要ね。これは、前にもチュートリアルで出てるから、
[最初のAPIユーザーをつくろう！]({filename}./create-your-first-apiuser-ja.md)に戻ってしっかり復習して、もしまだAPIユーザーを
つくってなかったら、つくっておいてくださいっ。
- あと、XoxzoのAPIでは、認証コードは自動作成しないから、発信したい認証コードは、自分で準備しておいてね！

## じゃぁ、いよいよ発信しましょう！ ##

ココでは、あなたの運営するサービスを「ウルトラ・サービス」そして準備した認証コードは「1234」だってことにするわねっ！
ただただ認証コードだけを発信するんじゃなくて、お電話するんだから、ご挨拶も入れたいわよねぇ？じゃぁ、発信音声は、こんな感じで
どうかなぁ？

「もしもし、こんにちは。ウルトラ・サービスです。あなたの認証コードは、1234です。」

どう？　
この電話を受取るひとにとっては、コードを覚えたり、メモしたりする余裕がほしいわよね。だから、コードの読み上げは
繰り返してあげるのが、親切だと思うのっ！

「もしもし、こんにちは。ウルトラ・サービスです。あなたの認証コードは、1234です。繰り返します。
あなたの認証コードは、1234です。」

このシンプル・プレイバック発信を行うURLは、`https://api.xoxzo.com/voice/simple/playbacks/`だから、
curlを使った場合、コマンドは、こんな感じになると思いまぁす。

```
curl -u th3ApISiDt3xtTh4tyoUcoPied:Th3aUthT0k3nth4tY0uCopi3D \
--data-urlencode 'caller=thecallerphonenumber' \
--data-urlencode 'recipient=yourphonenumber' \
--data-urlencode 'tts_lang=en' \
--data-urlencode 'tts_message="もしもし、こんにちは。ウルトラ・サービスです。あなたの認証コードは、1234です。繰り返します。
あなたの認証コードは、1234です。"' \
https://api.xoxzo.com/voice/simple/playbacks/
```

レスポンスは、callidが返りますよ。こんな感じ。 `[{"callid":"YoUr-5ucc355fuL-c4lL-Uu1D"}]` 
このcallidを使うと、 [ドキュメンテーションに、やり方が載ってるんだけど、](http://docs.xoxzo.com/ja/voice.html#checking-call-status) 
通話の後で、この発信の結果をチェックすることもできまぁす。

今、ご案内した通りにやってみたあなたは、気づいたかな。
読み上げられたコードは、「イチ・二・サン・シー」ではなかったわよね？「千二百三十四」（せんにひゃくさんじゅうよん）になってたかなぁ？
ひとつひとつの数字を区切って、しかも数字と数字の間に少し間をあけて、コードを読んでほしい場合、
`tts_message`の部分は、コンマを使って、こうやってみて！

`
tts_message="もしもし、こんにちは。ウルトラ・サービスです。あなたの認証コードは、 *1,,2,,3,,4*です。繰り返します。
あなたの認証コードは、 *1,,2,,3,,4*です。"
`

いかがでしたか？？

これで、あなたの「ウルトラ・サービス」へアクセスできるコードを、利用者様の電話へお知らせすることができます。
それに、あなたの方も、この電話番号が実際に存在していて、*タブン* 本物の人間だってことも、わかっちゃうよね！

ほかにも、Xoxzoでできる、すごいこと、たくさんあるから、その他の[ドキュメンテーション](https://docs.xoxzo.com/ja/)も、読んでみてね。
質問があったら、連絡してね。

ではまた次回！

[ミコちゃんのチュートリアル・シリーズ](https://blog.xoxzo.com/ja/tag/mikochiyan/)好評不定期連載中!
