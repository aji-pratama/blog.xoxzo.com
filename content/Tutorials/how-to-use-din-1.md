Title: ダイアルインナンバーを使ってみよう
Date: 2017/07/01
Author: Akira Nonaka
Tags: 
Slug: 
Lang: ja
Summary: 電話の着信を制御するダイアルインナンバーAPIの概要を解説します

## 概要

### ダイアルインナンバーとは?

ダイアルインナンバー(Dial in number;以降DINと書きます)はXOXZOの
テレフォニーAPIで、電話の着信を制御する機能です。ユーザーは、電話番号を
契約し、その電話に着信があった場合、転送やメッセージの再生するシステムを
APIを使って構築することができます。

利用するまでの大まかな流れは以下のようになります。

1. 空き番号を検索する
1. その中から、希望の電話番号を選び契約する
1. アクションサーバーを作る
1. アクションサーバーのURLを設定する

### 着信時の動作
 
契約した電話番号に対して着信があると、XOXZOのクラウドシステムは
設定されたアクションURLに対してHTTPリクエストを出します。
ユーザーはこのリクエストに対してアクションを応答するサーバを設置
しなければいけません。
アクションは、着信した電話をどのように処理するかをXOXZOクラウドシステムに対して指示するもので、
次の３つの種類があります。

<dl>
    <dt>playback
    <dd>指定されたMP3ファイルを再生
    <dt>transfer
    <dd>指定された電話番号へ転送する
    <dt>say
    <dd>指定されたテキストを読み上げる
</dl>

それでは、以下順を追って、DINシステムをどのように構築していくか、解説します。

## 空き番号を検索する

DINで利用可能な電話番号はXOXZOクラウドシステムがプールしていて、ユーザーはこの中から自分の好きな電話番号を
選ぶことができます。利用可能な電話番号の一覧を得るには次のAPIを使います。

[DIN検索API](http://docs.xoxzo.com/ja/din.html#finding-a-dial-in-number-via-api)

## 着信用電話番号を契約する

使いたい電話番号が決まったら、その番号を契約します。
契約にするには

[DIN契約API](http://docs.xoxzo.com/ja/din.html#subscribing-to-a-dial-in-number-via-api)

を使います。URLには検索APIで取得した `din_uid` を指定しましょう。

契約が成功したら

[DIN契約確認API](http://docs.xoxzo.com/ja/din.html#getting-the-list-of-subscribed-dial-in-numbers-via-api)

を使って、正しく契約されているかを確認しましょう。

## アクションサーバーをつくる

電話が着信したときのHTTPリクエストのメソッドは`GET`で２つのパラメータが付いています。

caller: 電話の発信者番号
recipient: 着信したDINの電話番号

アクションは１行のプレーンテキストで返し、

## アクションURLを設定する

## 電話番号を解約する

## トラブルシュート
